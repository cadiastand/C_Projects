#ifndef __PROGTEST__
#include <stdio.h>
#include <stdlib.h>
#include <limits.h>
#include <assert.h>
constexpr int MAP_MAX = 200;
#endif /* __PROGTEST__ */

//                           up   right 
const int directions_x[4] = { 0, -1,  0,   1};
const int directions_y[4] = {-1,  0,  1,   0};
//                                    down left

int search (int altitude[][MAP_MAX], int size, int x, int y) {
  int max_rect = 0;

  int broken_alts[MAP_MAX][2];

  for (int xs = 0; xs < size; xs++) {
    broken_alts[xs][0] = -1;
    broken_alts[xs][1] = size;
  }


  for (int xw = 0; xw < size; xw++) {

    for (int yt = y; yt >= 0; yt--) {
      if (altitude[yt][xw] >= altitude[y][x] && (xw != x || yt != y)) {
        broken_alts[xw][0] = yt; 
        break;
      }
    }
    
    for (int yb = y; yb < size; yb++) {
      if (altitude[yb][xw] >= altitude[y][x] && (xw != x || yb != y)) {
        broken_alts[xw][1] = yb;
        break;
      }
    }
  }

  for (int xl = 0; xl <= x; xl++) {
    for (int xr = size - 1; xr >= x; xr--) {

      int ty = INT_MIN, by = INT_MAX;
      for (int xs = xl; xs <= xr; xs++) {

        if (ty < broken_alts[xs][0])
          ty = broken_alts[xs][0];

        if (by > broken_alts[xs][1])
          by = broken_alts[xs][1];
      }

      if (max_rect < (xr - xl + 1) * (by - ty - 1)) 
        max_rect = (xr - xl + 1) * (by - ty - 1);
    }
  }

  return max_rect;
}


void castleArea ( int altitude[][MAP_MAX], int size, int area[][MAP_MAX] )
{
  
  for (int y = 0; y < size; y++) {
    for (int x = 0; x < size; x++) {

      area[y][x] = search(altitude, size, x, y);
    }
  }
}

#ifndef __PROGTEST__
bool identicalMap ( const int a[][MAP_MAX], const int b[][MAP_MAX], int n )
{
  for (int y = 0; y < n; y++) {
    for (int x = 0; x < n; x++) {
      if (a[y][x] != b[y][x]) return false;
    }
  }

  return true;
}

bool printMap ( const int a[][MAP_MAX], int n )
{
  for (int y = 0; y < n; y++) {
    for (int x = 0; x < n; x++) {
      printf("%4d ", a[y][x]);
    }
    printf("\n");
  }
  return true;
}

int main ( int argc, char * argv [] )
{
  static int result[MAP_MAX][MAP_MAX];

  static int alt0[MAP_MAX][MAP_MAX] =
  {
    { 1, 2 },
    { 3, 4 }
  };
  static int area0[MAP_MAX][MAP_MAX] =
  {
    { 1, 2 },
    { 2, 4 }
  };
  castleArea ( alt0, 2, result );
  assert ( identicalMap ( result, area0, 2 ) );

  static int alt1[MAP_MAX][MAP_MAX] =
  {
    { 2, 7, 1, 9 },
    { 3, 5, 0, 2 },
    { 1, 6, 3, 5 },
    { 1, 2, 2, 8 }
  };
  static int area1[MAP_MAX][MAP_MAX] =
  {
    { 1, 12, 2, 16 },
    { 4, 4, 1, 2 },
    { 1, 9, 4, 4 },
    { 1, 2, 1, 12 }
  };
  castleArea ( alt1, 4, result );
  assert ( identicalMap ( result, area1, 4 ) );

  static int alt2[MAP_MAX][MAP_MAX] =
  {
    { 1, 2, 3, 4 },
    { 2, 3, 4, 5 },
    { 3, 4, 5, 6 },
    { 4, 5, 6, 7 }
  };
  static int area2[MAP_MAX][MAP_MAX] =
  {
    { 1, 2, 3, 4 },
    { 2, 4, 6, 8 },
    { 3, 6, 9, 12 },
    { 4, 8, 12, 16 }
  };
  castleArea ( alt2, 4, result );
  assert ( identicalMap ( result, area2, 4 ) );
  
  static int alt3[MAP_MAX][MAP_MAX] =
  {
    { 7, 6, 5, 4 },
    { 6, 5, 4, 5 },
    { 5, 4, 5, 6 },
    { 4, 5, 6, 7 }
  };
  static int area3[MAP_MAX][MAP_MAX] =
  {
    { 12, 6, 2, 1 },
    { 6, 2, 1, 2 },
    { 2, 1, 2, 6 },
    { 1, 2, 6, 12 }
  };
  castleArea ( alt3, 4, result );
  assert ( identicalMap ( result, area3, 4 ) );
  static int alt4[MAP_MAX][MAP_MAX] =
  {
    { 1, 1, 1, 1, 1 },
    { 1, 1, 1, 1, 1 },
    { 1, 1, 2, 1, 1 },
    { 1, 1, 1, 1, 1 },
    { 1, 1, 1, 1, 1 }
  };
  static int area4[MAP_MAX][MAP_MAX] =
  {
    { 1, 1, 1, 1, 1 },
    { 1, 1, 1, 1, 1 },
    { 1, 1, 25, 1, 1 },
    { 1, 1, 1, 1, 1 },
    { 1, 1, 1, 1, 1 }
  };
  castleArea ( alt4, 5, result );
  assert ( identicalMap ( result, area4, 5 ) );

  static int alt5[MAP_MAX][MAP_MAX] = {
    { 578, 356, 766, 425, 12, 196, 850, 760, 431, 510, 513, 337, 875, 154, 307, 152, 390, 458, 495, 915, 932, 629, 882, 815, 25, 902, 966, 133 },
    { 692, 90, 455, 622, 798, 573, 48, 810, 121, 898, 922, 552, 761, 435, 241, 636, 942, 549, 140, 332, 359, 987, 599, 644, 616, 481, 459, 641 },
    { 383, 425, 774, 428, 868, 581, 402, 666, 154, 450, 829, 276, 701, 751, 180, 462, 539, 422, 98, 481, 323, 238, 813, 34, 225, 412, 678, 841 },
    { 246, 489, 834, 981, 267, 608, 761, 135, 541, 164, 153, 695, 614, 334, 323, 315, 86, 504, 777, 625, 278, 227, 106, 953, 465, 271, 987, 42 },
    { 35, 18, 235, 633, 507, 69, 615, 126, 677, 376, 613, 218, 540, 767, 266, 507, 101, 589, 822, 539, 445, 952, 164, 723, 531, 622, 676, 997 },
    { 245, 16, 391, 281, 386, 627, 914, 245, 696, 881, 372, 726, 610, 985, 944, 150, 104, 562, 9, 558, 504, 832, 97, 949, 136, 614, 25, 667 },
    { 236, 701, 16, 834, 69, 408, 115, 455, 35, 381, 53, 731, 615, 425, 457, 225, 762, 754, 375, 867, 668, 737, 425, 172, 921, 874, 474, 57 },
    { 488, 499, 76, 77, 552, 445, 911, 622, 853, 26, 429, 240, 759, 482, 323, 374, 259, 133, 599, 22, 239, 327, 241, 907, 64, 18, 432, 985 },
    { 892, 906, 394, 381, 405, 470, 458, 957, 267, 369, 931, 120, 747, 713, 712, 858, 547, 36, 585, 807, 169, 184, 181, 408, 863, 774, 667, 279 },
    { 792, 99, 264, 36, 357, 10, 769, 762, 833, 579, 72, 100, 300, 355, 221, 399, 68, 285, 258, 616, 321, 843, 775, 842, 379, 956, 602, 243 },
    { 82, 270, 874, 874, 721, 139, 262, 79, 501, 32, 841, 334, 611, 265, 435, 912, 621, 8, 311, 689, 293, 921, 305, 967, 764, 432, 809, 496 },
    { 388, 412, 91, 822, 34, 965, 696, 755, 456, 311, 834, 958, 343, 28, 644, 306, 293, 79, 570, 914, 439, 882, 956, 85, 155, 613, 52, 272 },
    { 46, 861, 768, 786, 625, 859, 609, 659, 176, 657, 415, 633, 968, 601, 943, 663, 629, 587, 970, 275, 19, 540, 189, 458, 774, 497, 543, 930 },
    { 111, 595, 202, 509, 809, 322, 295, 786, 533, 256, 798, 709, 914, 565, 694, 234, 166, 989, 250, 148, 577, 220, 423, 948, 112, 612, 406, 239 },
    { 462, 302, 521, 925, 249, 75, 434, 410, 397, 81, 197, 282, 338, 995, 343, 604, 912, 38, 190, 78, 379, 440, 226, 308, 12, 649, 256, 125 },
    { 614, 15, 716, 76, 317, 237, 1, 918, 312, 787, 329, 61, 868, 878, 343, 558, 225, 686, 162, 137, 76, 705, 215, 456, 145, 794, 116, 158 },
    { 443, 373, 635, 409, 388, 351, 837, 57, 940, 190, 327, 604, 977, 656, 17, 198, 886, 360, 756, 111, 398, 271, 248, 827, 976, 816, 635, 473 },
    { 610, 751, 631, 405, 476, 618, 815, 864, 321, 652, 273, 261, 843, 601, 217, 172, 609, 234, 370, 496, 946, 479, 607, 697, 102, 856, 524, 430 },
    { 24, 511, 903, 634, 262, 887, 39, 739, 505, 206, 955, 179, 859, 581, 440, 54, 534, 658, 578, 143, 244, 949, 639, 191, 780, 599, 888, 882 },
    { 807, 764, 312, 831, 275, 567, 465, 889, 454, 856, 980, 312, 63, 936, 491, 274, 869, 283, 680, 403, 293, 258, 546, 538, 559, 538, 729, 339 },
    { 489, 969, 573, 296, 733, 885, 127, 360, 805, 944, 249, 259, 152, 230, 923, 567, 518, 414, 193, 387, 50, 873, 142, 343, 132, 40, 881, 691 },
    { 578, 962, 383, 67, 931, 956, 715, 16, 194, 194, 376, 999, 490, 626, 610, 643, 208, 534, 562, 726, 300, 756, 465, 702, 629, 607, 46, 113 },
    { 647, 279, 157, 578, 242, 540, 997, 525, 496, 713, 894, 42, 907, 270, 41, 750, 248, 4, 745, 456, 890, 307, 534, 542, 63, 351, 245, 45 },
    { 310, 291, 158, 958, 570, 667, 888, 164, 207, 885, 42, 56, 950, 288, 98, 210, 558, 492, 960, 159, 848, 705, 967, 738, 12, 854, 280, 428 },
    { 205, 525, 825, 516, 168, 335, 826, 91, 3, 66, 255, 562, 303, 649, 970, 254, 937, 69, 816, 848, 913, 776, 359, 761, 833, 326, 851, 197 },
    { 180, 131, 625, 738, 657, 450, 606, 825, 138, 784, 268, 141, 850, 524, 703, 153, 525, 674, 759, 815, 95, 575, 663, 360, 703, 374, 473, 536 },
    { 700, 324, 86, 233, 455, 711, 323, 464, 514, 929, 642, 652, 713, 910, 145, 915, 786, 200, 68, 312, 874, 180, 479, 321, 755, 494, 681, 811 },
    { 868, 154, 347, 568, 830, 433, 153, 286, 497, 828, 102, 363, 757, 744, 367, 822, 7, 512, 89, 793, 712, 510, 457, 939, 690, 936, 612, 797 }
  };

  static int area5[MAP_MAX][MAP_MAX]= { 
    { 2, 2, 8, 3, 1, 2, 20, 5, 3, 2, 4, 1, 25, 1, 3, 1, 4, 5, 6, 36, 48, 1, 11, 6, 1, 12, 28, 1 }, 
    { 12, 1, 2, 3, 12, 2, 1, 16, 1, 32, 72, 3, 20, 4, 2, 10, 85, 8, 2, 2, 3, 338, 1, 6, 6, 3, 1, 4 }, 
    { 5, 3, 12, 1, 51, 4, 2, 6, 2, 3, 48, 1, 6, 14, 1, 4, 9, 2, 1, 6, 4, 2, 24, 1, 2, 3, 8, 23 }, 
    { 4, 8, 24, 273, 1, 5, 18, 2, 4, 2, 1, 12, 6, 4, 5, 2, 1, 5, 22, 10, 3, 2, 1, 88, 4, 1, 297, 1 },
    { 2, 2, 3, 12, 4, 1, 4, 1, 13, 2, 5, 1, 2, 28, 1, 6, 2, 12, 34, 2, 4, 81, 3, 5, 4, 10, 6, 588 }, 
    { 4, 1, 6, 1, 2, 14, 54, 3, 10, 36, 2, 9, 2, 286, 84, 2, 3, 6, 1, 4, 5, 12, 1, 55, 1, 3, 1, 4 },
    { 1, 16, 1, 24, 1, 3, 1, 7, 1, 3, 1, 12, 4, 1, 4, 2, 22, 14, 2, 48, 16, 9, 6, 1, 56, 10, 3, 1 }, 
    { 6, 4, 2, 2, 12, 2, 48, 5, 24, 1, 4, 3, 20, 6, 1, 4, 2, 2, 10, 1, 2, 6, 2, 52, 2, 1, 3, 230 }, 
    { 28, 60, 6, 3, 6, 8, 1, 115, 1, 2, 75, 2, 12, 12, 6, 36, 6, 1, 8, 20, 1, 3, 1, 4, 28, 4, 5, 2 }, 
    { 10, 1, 3, 1, 5, 1, 10, 4, 24, 10, 1, 2, 3, 5, 1, 9, 1, 5, 1, 12, 4, 25, 8, 4, 1, 96, 2, 1 }, 
    { 1, 2, 27, 24, 16, 2, 3, 1, 5, 1, 30, 4, 8, 2, 4, 54, 15, 1, 4, 10, 1, 60, 1, 162, 4, 1, 18, 4 }, 
    { 4, 4, 1, 9, 1, 180, 6, 12, 2, 2, 20, 114, 2, 1, 9, 3, 2, 2, 6, 60, 6, 12, 90, 1, 2, 6, 1, 2 },
    { 1, 24, 7, 4, 2, 24, 4, 6, 1, 10, 1, 2, 156, 5, 54, 11, 12, 6, 189, 5, 1, 6, 1, 2, 12, 1, 5, 51 }, 
    { 2, 6, 1, 2, 18, 3, 1, 20, 6, 2, 18, 9, 18, 1, 14, 2, 1, 378, 6, 4, 12, 1, 5, 36, 2, 4, 6, 3 }, 
    { 5, 2, 3, 80, 2, 1, 9, 6, 5, 1, 2, 3, 4, 567, 1, 12, 45, 1, 4, 1, 6, 8, 2, 3, 1, 11, 4, 1 }, 
    { 9, 1, 12, 1, 4, 2, 1, 40, 1, 13, 4, 1, 10, 20, 3, 10, 1, 14, 3, 3, 1, 20, 1, 6, 3, 22, 1, 2 },
    { 2, 3, 8, 6, 6, 4, 21, 1, 80, 1, 2, 8, 208, 9, 1, 3, 40, 2, 27, 1, 6, 2, 3, 21, 216, 14, 10, 5 }, 
    { 3, 18, 4, 1, 6, 9, 7, 20, 1, 6, 2, 2, 12, 6, 4, 2, 8, 1, 2, 9, 64, 2, 6, 8, 1, 30, 2, 1 },
    { 1, 2, 35, 8, 1, 27, 1, 4, 3, 1, 84, 1, 18, 4, 6, 1, 3, 14, 4, 1, 2, 96, 11, 1, 20, 3, 50, 15 },
    { 18, 7, 1, 12, 2, 3, 3, 25, 1, 14, 221, 4, 1, 64, 8, 4, 30, 1, 12, 6, 3, 1, 5, 3, 8, 2, 11, 1 }, 
    { 1, 180, 5, 2, 7, 10, 1, 2, 11, 72, 1, 4, 2, 2, 56, 6, 5, 4, 1, 3, 1, 33, 1, 4, 2, 1, 40, 7 },
    { 2, 42, 3, 1, 57, 80, 5, 1, 2, 1, 4, 784, 3, 6, 3, 9, 1, 6, 6, 16, 4, 16, 2, 16, 8, 6, 1, 2 },
    { 8, 2, 1, 6, 1, 2, 308, 8, 5, 6, 20, 1, 32, 2, 1, 15, 2, 1, 18, 2, 52, 1, 3, 7, 2, 4, 4, 1 },
    { 3, 4, 2, 72, 3, 8, 25, 2, 4, 15, 1, 2, 50, 4, 2, 2, 8, 3, 98, 1, 3, 2, 143, 10, 1, 30, 3, 6 }, 
    { 2, 6, 18, 3, 1, 2, 27, 3, 1, 2, 4, 6, 1, 7, 176, 3, 52, 1, 8, 16, 33, 9, 1, 10, 20, 1, 21, 1 },
    { 2, 1, 6, 14, 5, 2, 3, 18, 2, 8, 3, 1, 28, 1, 5, 1, 2, 12, 6, 15, 1, 3, 6, 2, 8, 2, 2, 5 }, 
    { 10, 3, 1, 2, 4, 10, 2, 4, 7, 69, 5, 10, 3, 16, 1, 39, 9, 2, 1, 3, 24, 1, 3, 1, 12, 3, 4, 14 },
    { 36, 1, 4, 6, 32, 3, 1, 2, 4, 18, 1, 2, 6, 2, 2, 13, 1, 4, 2, 8, 3, 4, 1, 84, 1, 54, 1, 2 } 
  };


  castleArea ( alt5, 28, result );
  assert ( identicalMap ( result, area5, 28 ) );
  return EXIT_SUCCESS;
}
#endif /* __PROGTEST__ */
